---
id: 586
title: Создание novokosino.tk
date: 2013-11-20T06:17:59+00:00
author: catethysis
layout: post
guid: http://catethysis.ru/?p=586
permalink: /novokosino-tk/
notely:
  - 
  - 
  - 
wp_noextrenallinks_mask_links:
  - 0
  - 0
  - 0
ratings_users:
  - 1
  - 1
  - 1
ratings_score:
  - 5
  - 5
  - 5
ratings_average:
  - 5
  - 5
  - 5
dsq_thread_id:
  - 2730608567
categories:
  - JavaScript
tags:
  - javascript
  - nginx
  - node.js
---
novokosino.tk был первым моим большим проектом на node.js. Более того, сам javascript я тогда знал на довольно низком уровне, и тем более мало знал про модули node.js &#8212; однако разработка продолжается и сейчас, и проект потихоньку стал напоминать Франкенштейна, на котором можно наблюдать &#171;пути становления&#187;. Параллельно в фоновом режиме идёт разработка новой версии, с более грамотным подходом к качеству кода и вообще архитектуре.

<!--more-->

## Инфраструктура и окружение

Всё работает на node.js, с nginx наружу. Смешно сказать, но даже отдача большинства файлов до сих пор лежит на плечах node.js &#8212; запрос, открытие/чтение файла, отдача содержимого с нужными заголовками&#8230; Этот подход уже был мной сто раз проклят, но пока оно остаётся в таком виде. Однако, сам node.js работает совершенно без нареканий и полностью меня устраивает.

## Собственно база картинок

Конечно, база картинок &#8212; самое главное, что есть на сайте. Раньше она была организована вообще без БД &#8212; в SVG-файле были ссылки на картинки с номерами, и при нажатии на такую ссылку с сервера просто забирался файл &#171;/photos/№_картинки.jpg&#187;. Когда количество фотографий превысило сотню, это тоже стало жутко напрягать, и в скором времени было переведено в базу данных. В SVG остался номер картинки, однако он теперь указывает на номер записи в БД, а в записи содержится уже всё нужное &#8212; адреса картинки во всех трёх размерах, связанные объекты, дата/место создания и прочее. Также создана база зданий, в которой пока хранятся только их названия.

## Интерактивная карта

Интерактивная карта является моей гордостью. Меня всегда привлекали векторные форматы, однако в то время я практически ничего не знал о SVG. Эта карта стала вообще первым опытом применения SVG &#8212; и надо сказать, очень успешно. Не нужно заводить активные области на img, либо как-то перехватывать нажатия с помощью яваскрипта &#8212; достаточно просто привязать js-обработчики ко всем объектам SVG. Правда, SVG-объекты пока не встраиваются автоматом в DOM (а тем более при автоматическом их создании), поэтому приходится вручную генерировать специальный SVG-DOM, однако это не так уж и сложно.

SVG поистине очень удобный формат. Сочетание удобства написания вручную (это просто XML), кроссбраузерности, скриптовых возможностей (интерактивность, динамическое добавление объектов, встроенная анимация) и малого размера, на мой взгляд, делают его приоритетным для создания подобных карт, интересных и лёгких фонов, и прочих элементов оформления. Ну и конечно, если вы рисуете какой-то изначально векторный интерфейс (например, органы управления SCADA) &#8212; то SVG становится вашим первым выбором.

Сначала я правил SVG вручную, добавляя в него всё новые и новые ссылки на фотографии. Но опять же, после добавления двухсотой фотографии был сделан скрипт, динамически добавляющий все эти объекты, получая их координаты из БД.
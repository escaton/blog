---
id: 509
title: 'STM32: Драйвер светодиода'
date: 2013-10-23T15:00:11+00:00
author: catethysis
layout: post
guid: http://catethysis.ru/?p=509
permalink: /stm32-power-led-driver/
ratings_users:
  - 3
  - 3
  - 3
ratings_score:
  - 14
  - 14
  - 14
ratings_average:
  - 4.67
  - 4.67
  - 4.67
notely:
  - 
  - 
  - 
wp_noextrenallinks_mask_links:
  - 0
  - 0
  - 0
dsq_thread_id:
  - 2726264115
categories:
  - STM32
  - Готовые девайсы
  - Исследования
tags:
  - STM32
  - электроника
---
Я купил мощный светодиод (5 ватт, 330 люмен), возник вопрос &#8212; как его включить? Конечно, к нему прилагался какой-то китайский драйвер, но захотелось пощупать процесс самому и понять, как это работает.

<!--more-->

Делаем новый проект в IAR. Будем разрабатывать с применением библиотеки [Itacone](http://catethysis.ru/index.php/stm32-itacone-library/ "Библиотека для STM32 — itacone"), но в конце поста я продублирую весь код в терминах StdPeriph.

Для начала, сформулируем цель: нужно питать светодиод неким током. Причём гораздо важнее именно стабильность тока, чем стабильность падения напряжения на светодиоде. Однако для начала попробуем просто подавать некую мощность (меньше максимальной) в светодиод, а чтобы не спалить его &#8212; ограничим эту мощность значением 60% от номинальной. Такой подход, конечно неправомерен для готового изделия, однако хорош для опытов &#8212; особенно если увеличивать подаваемую мощность плавно и с контролем тока.

Напряжение на светодиоде &#8212; около 7 вольт. Это меньше, чем имеющиеся у меня 12 вольт от мощного аккумулятора &#8212; поэтому сделаем понижающий преобразователь.

По сути, всё просто: затвор полевого транзистора управляется [ножкой PB12,](http://catethysis.ru/stm32-%e2%86%92-%d0%bf%d0%be%d1%80%d1%82%d1%8b-gpio/ "STM32 → Порты GPIO") транзистор коммутирует цепь &#171;земли&#187;, заряжая конденсатор, а чтобы ограничить ток заряда &#8212; последовательно стоит дроссель. Параллельно конденсатору установлен светодиод.

<pre>#include &lt;itacone.h&gt;

PB12.mode(OUT).low();
while(1) PB12.high().delay(10).low().delay(3000);</pre>

Разработка с применением itacone &#8212; это просто сказка <img src="http://catethysis.ru/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />

Значения задержек взяты просто с потолка &#8212; на самом деле, я точно знаю что при скважности 1/300 в светодиод не пройдёт хоть сколько-нибудь значительная мощность. Теперь можно медленно повышать [скважность](http://catethysis.ru/stm32-%e2%86%92-%d1%82%d0%b0%d0%b9%d0%bc%d0%b5%d1%80%d1%8b-%e2%86%92-%d1%88%d0%b8%d0%bc/ "STM32 → таймеры → ШИМ"), каждый раз следя за током светодиода. В моём случае для светодиода 7В*700мА оказалось достаточно задержек 200/3000 при частоте работы МК 24МГц.
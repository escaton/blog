---
id: 2438
title: Консольный программатор ST-Link_Utility-CLI
date: 2015-07-27T20:47:21+00:00
author: Catethysis
layout: post
guid: http://catethysis.ru/?p=2438
permalink: /st-link_utility-cli/
ratings_users:
  - 1
ratings_score:
  - 5
ratings_average:
  - 5
wp_noextrenallinks_mask_links:
  - 0
dsq_thread_id:
  - 3976996262
categories:
  - STM32
  - Справочник
---
В комплекте поставки программатора ST-Link есть не только графическая утилита ST-Link Utility, но и консольная программа ST-LINK_CLI.exe. Она даёт возможность автоматизировать процесс прошивки МК, что крайне полезно если плат много (десятки или сотни).

Я написал простейший скрипт. Он принимает путь к файлу прошивки (в параметрах командной строки) и прошивает его в микроконтроллер STM32. После этого он ждёт нажатия любой клавиши чтобы запустить процесс заново — нажимаете любую клавишу чтобы прошить следующий девайс, либо закрываете консоль чтобы закончить.

<pre><code class="dos">:start
"C:\Program Files (x86)\STMicroelectronics\STM32 ST-LINK Utility\ST-LINK Utility\ST-LINK_CLI.exe" -P %1 0x08000000
pause
goto start</code></pre>

Только проверьте правильность пути до вашего ST-Link Utility.

  1. Подключаете первую плату с STM32 к программатору ST-Link.
  2. Копируете текст в любой текстовый редактор (лучше в Блокнот), сохраняете его как файл с расширением .bat (например programmer.bat), перетаскиваете на этот файл свой файл прошивки (.bin), и всё — он записывается внутрь микроконтроллера.
  3. После завершения записи подключаете следующую плату, нажимаете любую клавишу — она тоже прошивается, и так далее.

[<img class="alignnone size-full wp-image-2439" src="http://catethysis.ru/wp-content/uploads/2015/07/programmer.png" alt="programmer" width="677" height="775" />](http://catethysis.ru/wp-content/uploads/2015/07/programmer.png)

Это простейший вариант, но его можно расширить, например, до полностью автоматического программатора с обратной связью — с &#171;железной&#187; кнопкой начала программирования и светодиодами статуса.

При желании можно добавить команду подключения к STM32 с определёнными параметрами:

<pre>"C:\Program Files (x86)\STMicroelectronics\STM32 ST-LINK Utility\ST-LINK Utility\ST-LINK_CLI.exe"<strong> -c SWD SWCLK=0 UR LPM</strong> -p %1 0x08000000</pre>

В этом примере я увеличил скорость SWD до 4МГц, но эффективность этого способа мала — очень много времени (несколько секунд) уходит на подключение. Первый вариант был быстрее — около 1-2 секунд на плату.
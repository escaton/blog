---
id: 1825
title: STM32 → 1-Wire
date: 2014-07-10T09:58:17+00:00
author: Catethysis
layout: post
guid: http://catethysis.ru/?p=1825
permalink: /stm32-1-wire/
wp_noextrenallinks_mask_links:
  - 0
ratings_users:
  - 1
ratings_score:
  - 5
ratings_average:
  - 5
dsq_thread_id:
  - 2829380355
categories:
  - STM32
  - Справочник
tags:
  - 1-wire
  - STM32
  - датчики
  - интерфейсы
  - электроника
---
1-Wire &#8212; самый низкоскоростной и малораспространённый интерфейс, который тем не менее обладает замечательной особенностью &#8212; всего одна линия данных. Разработан компанией Dallas и применяется только в их продуктах: датчиках температуры, часах точного времени, энергонезависимой памяти в формате iButton.

**Топология**: Шина, одна двунаправленная линия DQ, подтянутая к + через резистор. Допускается до 256 девайсов на линии.
  
Кодирование: биты 0 и 1 кодируются как &#171;0&#187; импульсы разной длительности (0 &#8212; 90 мкс, 1 &#8212; 5 мкс) и &#171;1&#187; до конца тайм-слота &#8212; 400-500 мкс. Перед началом передачи в линию выдаётся сигнал &#171;старт&#187; (мастер притягивает шину к земле на 400 мкс, после этого девайс притягивает шину к земле на 100мкс).

**Фичи**: Благодаря тому, что в состоянии покоя и в паузах между битами линия принимает состояние &#171;1&#187; (т.е. +) и малому потреблению микросхем на шине 1-wire, становится возможным питать слейвы от линии данных через диод и конденсатор &#8212; весь канал связи сокращается до 2 линий, DQ и GND. В некоторых 1-Wire устройствах эта цепь уже встроена внутрь микросхемы, они имеют суффикс -PAR (паразитное питание).

## Плюсы и минусы

Плюсы:

  * из-за низкой скорости интерфейс неприхотлив &#8212; устойчив к помехам, нет ЭМИ
  * встроенный CRC
  * Простота реализации &#8212; достаточно всего одной ножки ввода-вывода STM32, программа довольно проста (хотя и сложнее, чем реализация SPI)

Минусы:

  * Нет аппаратных модулей в МК, нужно реализовывать протокол обмена вручную
  * Очень низкая скорость
  * Поддержка только одним производителем.

Довольно часто интерфейс 1-Wire эмулируют с помощью UART, но мне это кажется плохой идеей.

## Применение

Без преувеличения, самое частое применение в хобби-электронике &#8212; это подключение цифровых термометров DS18B20. У меня есть статья о [подключении DS18B20 к STM32](http://catethysis.ru/stm32-1-wire-18b20/), и серия статей о создании на базе этого термометра и других датчиков [домашней метеостанции](http://catethysis.ru/home-meteostation-stm32/).

На больших расстояниях и в условиях помех иногда общение по шине 1-Wire сбивается, чтобы этого не произошло &#8212; моя подборка [улучшений для шины 1-Wire.](http://catethysis.ru/1-wire-tipsntricks/)
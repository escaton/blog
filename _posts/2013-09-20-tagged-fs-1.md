---
id: 228
title: Тег-ориентированная файловая система — вступление
date: 2013-09-20T07:24:21+00:00
author: catethysis
layout: post
guid: http://catethysis.ru/?p=228
permalink: /tagged-fs-1/
ratings_users:
  - 1
  - 1
  - 1
ratings_score:
  - 5
  - 5
  - 5
ratings_average:
  - 5
  - 5
  - 5
wp_noextrenallinks_mask_links:
  - 0
dsq_thread_id:
  - 2726263425
categories:
  - Программирование
tags:
  - теговая фс
---
Всё началось с того, что у меня накопились фотографии. Думаю, многим знакомо это чувство:

<img alt="" src="http://cs312923.vk.me/v312923150/3c4f/AeKdMoAG8WY.jpg" width="604" height="272" />

Ещё хуже, если &#171;драйвер&#187; фотоаппарата раскладывает все фотографии по датам. По-моему, так вообще невозможно ничего найти. Поэтому я попробовал хранить фотографии с тегами, и пускай это нельзя по-настоящему назвать файловой системой &#8212; свои функции она уже выполняет.

<!--more-->

### Архитектура

Начнём с архитектуры системы (ну логично, правда?). Пускай файлы хранятся как есть, т.е. файлами &#8212; а вся система тегов будет храниться в базе данных. Не очень удобно с точки зрения переносимости &#8212; зато мы избавлены от необходимости лазить в мета-теги и как-то там эту информацию складировать. Более того, при использовании меты мы не получаем общего индекса файлов, да и прочитать информацию из всей меты при поиске &#8212; жжжутко медленно.

### Классификация и тегирование

Далее, по какой системе классифицировать файлы и назначать теги? Я предлагаю использовать плоскую систему тегов, без вложенных уровней. Любые сложные вложенности (вроде &#171;поездка в Киев, но не летняя а весенняя&#187;) почти всегда решаются учётом даты создания фотографии.

### Хранение

Теперь, как хранить фотографии? Если оставлять их начальные имена &#8212; мы совершенно не застрахованы от их повторения даже в пределах нашей базы; более того, коллизии обязательно будут. Если назначать им последовательные номера с ноля &#8212; мы оставляем бомбу замедленного действия: если нам когда-то понадобится слить две базы вместе, мы не сможем сделать это просто слиянием папок (названия файлов будут совпадать). Даже если мы установим некий префикс файлам одной из папок &#8212; в базе тоже придётся это учесть.

Поэтому можно использовать в качестве новых имён файлов GUID (и он же будет их идентификатором в базе). Кто-то может возразить, что хранить GUID в качестве индекса базы &#8212; это медленно и погано, но я пока не заметил никаких проблем: даже на атоме база с 300 фотографиями крутится очень быстро. Прелесть GUID\`а в том, что он практически гарантирует неповторяемость &#8212; вероятность существования одинаковых номеров стремится к нулю. К тому же DOS и ZipMagic уже забрали ту единственную вероятность совпадения на миллион лет (шутка). Поэтому сливать две базы будет легко и просто.

### При просмотре

Для удобного просмотра нужно иметь превьюшку (для каталога) и средний размер для просмотра. Полный размер оставим для возможности печати и придирчивого просмотра  <img src="http://catethysis.ru/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />Генерировать эти превьюшки будем сразу после добавления фотографии в базу.

[Продолжение](http://catethysis.ru/?p=230 "Тег-ориентированная файловая система — архитектура")